<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë ˆíŠ¸ë¡œ ì˜ìˆ˜ì¦ ë©”ì´ì»¤</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- html2canvas (Image Generation) -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* ìš”ì²­í•˜ì‹  í°íŠ¸ ì •ì˜ */
        @font-face {
            font-family: 'DosGothic';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_eight@1.0/DOSGothic.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'DosMyungjo';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_eight@1.0/DOSMyungjo.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }

        body {
            background-color: #1a1a1a;
            font-family: 'DosGothic', sans-serif;
        }

        /* ì˜ìˆ˜ì¦ í†±ë‹ˆë°”í€´ íš¨ê³¼ (ìƒë‹¨/í•˜ë‹¨) */
        .receipt-edge-top {
            background: linear-gradient(135deg, #f8f8f8 10px, transparent 0) 0 10px,
                        linear-gradient(225deg, #f8f8f8 10px, transparent 0) 0 10px;
            background-position: top left;
            background-repeat: repeat-x;
            background-size: 20px 20px;
            height: 20px;
            width: 100%;
            position: absolute;
            top: -10px;
            left: 0;
        }

        .receipt-edge-bottom {
            background: linear-gradient(315deg, #f8f8f8 10px, transparent 0) 0 0,
                        linear-gradient(45deg, #f8f8f8 10px, transparent 0) 0 0;
            background-position: bottom left;
            background-repeat: repeat-x;
            background-size: 20px 20px;
            height: 20px;
            width: 100%;
            position: absolute;
            bottom: -10px;
            left: 0;
        }

        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d2d2d; 
        }
        ::-webkit-scrollbar-thumb {
            background: #555; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #777; 
        }

        .font-myungjo {
            font-family: 'DosMyungjo', serif;
        }
    </style>
</head>
<body class="text-white min-h-screen flex flex-col items-center py-10">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect, useMemo } = React;

        function App() {
            // ê¸°ë³¸ ë°ì´í„° ìƒíƒœ
            const [storeName, setStoreName] = useState("ì½”ë”© ë¬¸ë°©êµ¬");
            const [storeAddress, setStoreAddress] = useState("ì„œìš¸ì‹œ ë””ì§€í„¸êµ¬ ì›¹ê°œë°œë¡œ 123");
            const [orderDate, setOrderDate] = useState(new Date().toISOString().slice(0, 10));
            const [orderTime, setOrderTime] = useState(new Date().toTimeString().slice(0, 5));
            const [footerMessage, setFooterMessage] = useState("ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.\në˜ ë°©ë¬¸í•´ ì£¼ì„¸ìš”!");
            const [barcodeNum, setBarcodeNum] = useState("8801234 567890"); 
            
            // ë¶€ê°€ì„¸ ì»¤ìŠ¤í…€ ìƒíƒœ (nullì´ë©´ ìë™ 10%, ìˆ«ìë©´ ìˆ˜ë™)
            const [customTax, setCustomTax] = useState(null);
            
            // í’ˆëª© ë¦¬ìŠ¤íŠ¸ ìƒíƒœ
            const [items, setItems] = useState([
                { id: 1, name: "ë ˆíŠ¸ë¡œ í‚¤ë³´ë“œ", qty: 1, price: 125000 },
                { id: 2, name: "ì•„ì´ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸", qty: 2, price: 4500 },
                { id: 3, name: "DOS í°íŠ¸ ë¼ì´ì„¼ìŠ¤", qty: 1, price: 0 },
            ]);

            const receiptRef = useRef(null);

            // ì´ì•¡ ê³„ì‚°
            const totalAmount = items.reduce((sum, item) => sum + (item.price * item.qty), 0);
            
            // ë¶€ê°€ì„¸ ê³„ì‚°: customTaxê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ê·¸ ê°’, ì•„ë‹ˆë©´ ì´ì•¡ì˜ 10%
            const taxAmount = customTax !== null ? customTax : Math.floor(totalAmount * 0.1);
            
            // ê³µê¸‰ê°€ì•¡ ê³„ì‚°: ì´ì•¡ - ë¶€ê°€ì„¸
            const netAmount = totalAmount - taxAmount;

            // í’ˆëª© ì¶”ê°€
            const addItem = () => {
                const newItem = {
                    id: Date.now(),
                    name: "ìƒˆ í’ˆëª©",
                    qty: 1,
                    price: 0
                };
                setItems([...items, newItem]);
            };

            // í’ˆëª© ì‚­ì œ
            const deleteItem = (id) => {
                setItems(items.filter(item => item.id !== id));
            };

            // í’ˆëª© ì—…ë°ì´íŠ¸
            const updateItem = (id, field, value) => {
                setItems(items.map(item => 
                    item.id === id ? { ...item, [field]: value } : item
                ));
            };

            // ì´ë¯¸ì§€ ì €ì¥
            const handleSaveImage = async () => {
                if (!receiptRef.current) return;

                try {
                    const canvas = await html2canvas(receiptRef.current, {
                        scale: 2,
                        backgroundColor: null,
                        logging: false
                    });

                    const image = canvas.toDataURL("image/png");
                    const link = document.createElement("a");
                    link.href = image;
                    link.download = `ì˜ìˆ˜ì¦_${storeName}_${orderDate}.png`;
                    link.click();
                } catch (err) {
                    console.error("ì´ë¯¸ì§€ ì €ì¥ ì‹¤íŒ¨:", err);
                    alert("ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            };

            // ìˆ«ì í¬ë§· (ì„¸ìë¦¬ ì½¤ë§ˆ)
            const formatCurrency = (num) => {
                return new Intl.NumberFormat('ko-KR').format(num);
            };

            // ê°€ìƒ ë°”ì½”ë“œ íŒ¨í„´ ìƒì„±ê¸° (CSS linear-gradient ì´ìš©)
            const getBarcodeStyle = (text) => {
                if (!text) return { background: 'none' };

                let gradient = 'linear-gradient(90deg, ';
                let pos = 5; // ì‹œì‘ ìœ„ì¹˜ (ì—¬ë°±)

                // ì‹œì‘ ê°€ë“œ ë°”
                gradient += `#000 ${pos}%, #000 ${pos + 1.5}%, transparent ${pos + 1.5}%, transparent ${pos + 3}%, `;
                pos += 3;

                // ë¬¸ìì—´ì— ë”°ë¥¸ íŒ¨í„´ ìƒì„±
                for (let i = 0; i < text.length; i++) {
                    const code = text.charCodeAt(i);
                    const barWidth = 0.8 + (code % 4) * 0.4; // ë°” ë‘ê»˜ ë‹¤ì–‘í™”
                    const gapWidth = 0.8 + (code % 3) * 0.4; // ê°„ê²© ë‹¤ì–‘í™”

                    if (pos > 90) break;

                    gradient += `#000 ${pos}%, #000 ${pos + barWidth}%, transparent ${pos + barWidth}%, transparent ${pos + barWidth + gapWidth}%, `;
                    pos += (barWidth + gapWidth);
                }

                // ë ê°€ë“œ ë°”
                if (pos < 95) {
                    gradient += `#000 ${pos}%, #000 ${pos + 1.5}%, transparent ${pos + 1.5}%, transparent ${pos + 3}%`;
                } else {
                     gradient = gradient.slice(0, -2);
                }
                
                if (gradient.endsWith(', ')) gradient = gradient.slice(0, -2);
                gradient += ')';
                return { backgroundImage: gradient };
            };

            return (
                <div className="container mx-auto px-4 max-w-6xl">
                    <header className="text-center mb-10">
                        <h1 className="text-4xl md:text-5xl font-myungjo text-yellow-500 mb-2">ì˜ìˆ˜ì¦ ì œì¡°ê¸°</h1>
                        <p className="text-gray-400">ë‚˜ë§Œì˜ ë ˆíŠ¸ë¡œ ì˜ìˆ˜ì¦ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.</p>
                    </header>

                    <div className="flex flex-col lg:flex-row gap-8 justify-center items-start">
                        
                        {/* ì™¼ìª½: ì…ë ¥ íŒ¨ë„ */}
                        <div className="w-full lg:w-1/2 bg-gray-800 p-6 rounded-lg shadow-xl border border-gray-700">
                            <h2 className="text-2xl font-bold mb-6 border-b border-gray-600 pb-2">ğŸ§¾ ë‚´ìš© ì…ë ¥</h2>
                            
                            {/* ìƒì  ì •ë³´ */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label className="block text-sm text-gray-400 mb-1">ìƒí˜¸ëª…</label>
                                    <input 
                                        type="text" 
                                        value={storeName}
                                        onChange={(e) => setStoreName(e.target.value)}
                                        className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:outline-none focus:border-yellow-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm text-gray-400 mb-1">ë‚ ì§œ</label>
                                    <input 
                                        type="date" 
                                        value={orderDate}
                                        onChange={(e) => setOrderDate(e.target.value)}
                                        className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:outline-none focus:border-yellow-500"
                                    />
                                </div>
                                <div className="md:col-span-2">
                                    <label className="block text-sm text-gray-400 mb-1">ì£¼ì†Œ/ì—°ë½ì²˜</label>
                                    <input 
                                        type="text" 
                                        value={storeAddress}
                                        onChange={(e) => setStoreAddress(e.target.value)}
                                        className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:outline-none focus:border-yellow-500"
                                    />
                                </div>
                            </div>

                            {/* í’ˆëª© ë¦¬ìŠ¤íŠ¸ */}
                            <div className="mb-6">
                                <div className="flex justify-between items-center mb-2">
                                    <label className="text-sm text-gray-400">ì£¼ë¬¸ ë‚´ì—­</label>
                                    <button 
                                        onClick={addItem}
                                        className="bg-yellow-600 hover:bg-yellow-500 text-white px-3 py-1 rounded text-sm transition-colors"
                                    >
                                        + í’ˆëª© ì¶”ê°€
                                    </button>
                                </div>
                                <div className="space-y-2 max-h-[300px] overflow-y-auto pr-2">
                                    {items.map((item, index) => (
                                        <div key={item.id} className="flex gap-2 items-center bg-gray-900 p-2 rounded border border-gray-700">
                                            <input 
                                                type="text" 
                                                value={item.name}
                                                onChange={(e) => updateItem(item.id, 'name', e.target.value)}
                                                placeholder="í’ˆëª©ëª…"
                                                className="flex-grow bg-transparent border-b border-gray-700 focus:border-yellow-500 focus:outline-none text-sm w-1/3"
                                            />
                                            <input 
                                                type="number" 
                                                value={item.qty}
                                                onChange={(e) => updateItem(item.id, 'qty', parseInt(e.target.value) || 0)}
                                                placeholder="ìˆ˜ëŸ‰"
                                                className="w-12 bg-transparent border-b border-gray-700 focus:border-yellow-500 focus:outline-none text-right text-sm"
                                            />
                                            <input 
                                                type="number" 
                                                value={item.price}
                                                onChange={(e) => updateItem(item.id, 'price', parseInt(e.target.value) || 0)}
                                                placeholder="ê°€ê²©"
                                                className="w-20 bg-transparent border-b border-gray-700 focus:border-yellow-500 focus:outline-none text-right text-sm"
                                            />
                                            <button 
                                                onClick={() => deleteItem(item.id)}
                                                className="text-red-400 hover:text-red-300 p-1"
                                                title="ì‚­ì œ"
                                            >
                                                &times;
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>

                             {/* í•˜ë‹¨ ë©”ì‹œì§€, ë°”ì½”ë“œ, ë¶€ê°€ì„¸ ì„¤ì • */}
                             <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div className="md:col-span-2">
                                    <label className="block text-sm text-gray-400 mb-1">í•˜ë‹¨ ë©”ì‹œì§€</label>
                                    <textarea 
                                        value={footerMessage}
                                        onChange={(e) => setFooterMessage(e.target.value)}
                                        rows="2"
                                        className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:outline-none focus:border-yellow-500 text-sm"
                                    ></textarea>
                                </div>
                                
                                {/* ë¶€ê°€ì„¸ ì„¤ì • ì˜ì—­ */}
                                <div className="md:col-span-2 bg-gray-900 p-3 rounded border border-gray-700">
                                    <div className="flex justify-between items-center mb-2">
                                        <label className="text-sm text-gray-300 flex items-center gap-2">
                                            <span className="text-yellow-500">ğŸ’°</span> ë¶€ê°€ì„¸(VAT) ì§ì ‘ ì„¤ì •
                                        </label>
                                        {customTax !== null && (
                                            <button 
                                                onClick={() => setCustomTax(null)}
                                                className="text-xs bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded text-gray-300 transition-colors"
                                            >
                                                â†º ìë™ ê³„ì‚°(10%) ë³µêµ¬
                                            </button>
                                        )}
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <input 
                                            type="number" 
                                            value={taxAmount}
                                            onChange={(e) => setCustomTax(parseInt(e.target.value) || 0)}
                                            className={`w-full bg-gray-800 border rounded p-2 text-white focus:outline-none focus:border-yellow-500 text-right ${customTax !== null ? 'border-yellow-500 text-yellow-500' : 'border-gray-600'}`}
                                        />
                                        <span className="text-gray-400 text-sm">ì›</span>
                                    </div>
                                    <p className="text-xs text-gray-500 mt-2 text-right">
                                        {customTax !== null 
                                            ? "âœ¨ ì‚¬ìš©ì ì§€ì • ë¶€ê°€ì„¸ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤." 
                                            : "ê¸°ë³¸ê°’: ì£¼ë¬¸ ì´ì•¡ì˜ 10%ê°€ ìë™ ì ìš©ë©ë‹ˆë‹¤."}
                                    </p>
                                </div>

                                <div className="md:col-span-2">
                                    <label className="block text-sm text-gray-400 mb-1">ë°”ì½”ë“œ ë²ˆí˜¸ (ììœ  ì…ë ¥)</label>
                                    <input 
                                        type="text" 
                                        value={barcodeNum}
                                        onChange={(e) => setBarcodeNum(e.target.value)}
                                        placeholder="ë°”ì½”ë“œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                                        className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:outline-none focus:border-yellow-500 font-mono tracking-widest"
                                    />
                                    <p className="text-xs text-gray-500 mt-1">* ì…ë ¥ê°’ì— ë”°ë¼ ë°”ì½”ë“œ ëª¨ì–‘ì´ ë°”ë€ë‹ˆë‹¤.</p>
                                </div>
                            </div>

                            <button 
                                onClick={handleSaveImage}
                                className="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg shadow-lg transition-transform transform hover:scale-105 flex justify-center items-center gap-2"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ ì €ì¥í•˜ê¸°
                            </button>
                        </div>

                        {/* ì˜¤ë¥¸ìª½: ë¯¸ë¦¬ë³´ê¸° (ì‹¤ì œ ì €ì¥ë˜ëŠ” ì˜ì—­) */}
                        <div className="w-full lg:w-[380px] flex justify-center">
                            
                            {/* ì˜ìˆ˜ì¦ ì»¨í…Œì´ë„ˆ */}
                            <div className="relative w-[340px] pt-4 pb-4">
                                
                                {/* í†±ë‹ˆ ëª¨ì–‘ ë°°ê²½ */}
                                <div className="receipt-edge-top z-10"></div>

                                {/* ì‹¤ì œ ì˜ìˆ˜ì¦ ë³¸ë¬¸ */}
                                <div 
                                    id="receipt-preview" 
                                    ref={receiptRef}
                                    className="bg-[#f8f8f8] text-black p-6 min-h-[500px] shadow-2xl relative"
                                    style={{
                                        boxShadow: "0 10px 20px rgba(0,0,0,0.5)"
                                    }}
                                >
                                    {/* ìƒë‹¨ í†±ë‹ˆ ê°€ë¦¬ê¸°ìš© í°ìƒ‰ ë°” */}
                                    <div className="absolute top-0 left-0 w-full h-4 bg-[#f8f8f8] -mt-2"></div>

                                    {/* Header */}
                                    <div className="text-center mb-6">
                                        <h2 className="text-3xl font-myungjo font-bold mb-2 tracking-widest">{storeName}</h2>
                                        <p className="text-xs text-gray-600 mb-1">{storeAddress}</p>
                                        <p className="text-xs text-gray-600">TEL: 02-1234-5678</p>
                                        <div className="mt-4 text-xs flex justify-between border-b-2 border-dashed border-black pb-2">
                                            <span>NO. {new Date().getTime().toString().slice(-6)}</span>
                                            <span>{orderDate} {orderTime}</span>
                                        </div>
                                    </div>

                                    {/* Items Header */}
                                    <div className="flex text-sm font-bold border-b border-black pb-1 mb-2">
                                        <span className="w-[50%]">í’ˆëª…</span>
                                        <span className="w-[15%] text-center">ìˆ˜ëŸ‰</span>
                                        <span className="w-[35%] text-right">ê¸ˆì•¡</span>
                                    </div>

                                    {/* Items List */}
                                    <div className="flex flex-col gap-2 mb-4 min-h-[100px]">
                                        {items.map((item) => (
                                            <div key={item.id} className="flex text-sm items-start">
                                                <span className="w-[50%] break-words pr-1 leading-tight">{item.name}</span>
                                                <span className="w-[15%] text-center">{item.qty}</span>
                                                <span className="w-[35%] text-right font-bold">{formatCurrency(item.price * item.qty)}</span>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Total Calculation */}
                                    <div className="border-t-2 border-dashed border-black pt-2 mb-6">
                                        <div className="flex justify-between text-sm mb-1 text-gray-600">
                                            <span>ê³µê¸‰ê°€ì•¡</span>
                                            <span>{formatCurrency(netAmount)}</span>
                                        </div>
                                        <div className="flex justify-between text-sm mb-2 text-gray-600">
                                            <span>ë¶€ê°€ì„¸</span>
                                            <span>{formatCurrency(taxAmount)}</span>
                                        </div>
                                        <div className="flex justify-between text-xl font-bold border-t border-black pt-2">
                                            <span className="font-myungjo">í•© ê³„</span>
                                            <span>â‚© {formatCurrency(totalAmount)}</span>
                                        </div>
                                    </div>

                                    {/* Footer */}
                                    <div className="text-center space-y-4">
                                        <div className="text-sm whitespace-pre-wrap leading-relaxed">
                                            {footerMessage}
                                        </div>
                                        
                                        {/* Dynamic Barcode Simulation */}
                                        <div className="mt-4">
                                            <div 
                                                className="h-12 w-full opacity-90"
                                                style={getBarcodeStyle(barcodeNum)}
                                            ></div>
                                            <div className="text-[10px] tracking-[0.5em] text-center font-mono mt-1">
                                                {barcodeNum}
                                            </div>
                                        </div>
                                    </div>

                                    {/* í•˜ë‹¨ í†±ë‹ˆ ê°€ë¦¬ê¸°ìš© í°ìƒ‰ ë°” */}
                                    <div className="absolute bottom-0 left-0 w-full h-4 bg-[#f8f8f8] -mb-2"></div>
                                </div>

                                <div className="receipt-edge-bottom z-10"></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
